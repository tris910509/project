<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pembayaran</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h2 class="text-center">Pembayaran</h2>

        <!-- Pembayaran Form -->
        <form id="pembayaranForm">
            <div class="mb-3">
                <label for="transaksi" class="form-label">Pilih Transaksi</label>
                <select class="form-select" id="transaksi" required>
                    <option value="" disabled selected>Pilih Transaksi</option>
                </select>
            </div>

            <div class="mb-3">
                <label for="statusPembayaran" class="form-label">Status Pembayaran</label>
                <select class="form-select" id="statusPembayaran" required>
                    <option value="Pending">Pending</option>
                    <option value="Sedang Proses Verifikasi">Sedang Proses Verifikasi</option>
                    <option value="Belum Lunas">Belum Lunas</option>
                    <option value="Lunas">Lunas</option>
                </select>
            </div>

            <div class="mb-3">
                <label for="konfirmasiPembayaran" class="form-label">Konfirmasi Pembayaran</label>
                <button type="button" class="btn btn-secondary" id="konfirmasiPembayaran">Konfirmasi Pembayaran</button>
            </div>

            <button type="submit" class="btn btn-primary">Simpan Pembayaran</button>
        </form>

        <!-- Struk Pembayaran -->
        <div id="strukPembayaran" class="d-none mt-4">
            <h4>Struk Pembayaran</h4>
            <div id="strukContent"></div>
            <button class="btn btn-success mt-3" onclick="window.print()">Cetak Struk</button>
        </div>
    </div>

    <script>
        const transaksiList = JSON.parse(localStorage.getItem('transaksi')) || [];

        // Render dropdown transaksi
        function renderTransaksi() {
            const transaksiSelect = document.getElementById('transaksi');
            transaksiList.forEach((transaksi, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = `Transaksi ${index + 1} - ${transaksi.pelanggan} - Rp ${transaksi.total}`;
                transaksiSelect.appendChild(option);
            });
        }

        // Konfirmasi pembayaran
        document.getElementById('konfirmasiPembayaran').addEventListener('click', function() {
            const transaksiIndex = document.getElementById('transaksi').value;
            const status = document.getElementById('statusPembayaran').value;

            if (transaksiIndex !== "" && status !== "") {
                transaksiList[transaksiIndex].status = status;
                localStorage.setItem('transaksi', JSON.stringify(transaksiList));
                renderStruk(transaksiList[transaksiIndex]);
            } else {
                alert("Silakan pilih transaksi dan status pembayaran");
            }
        });

        // Render struk pembayaran
        function renderStruk(transaksi) {
            const strukContent = document.getElementById('strukContent');
            strukContent.innerHTML = `
                <p><strong>Pelanggan:</strong> ${transaksi.pelanggan}</p>
                <p><strong>Metode Pembayaran:</strong> ${transaksi.metodePembayaran}</p>
                <p><strong>Total:</strong> Rp ${transaksi.total}</p>
                <p><strong>Dibayar:</strong> Rp ${transaksi.bayar}</p>
                <p><strong>Kembalian:</strong> Rp ${transaksi.kembalian}</p>
                <p><strong>Status Pembayaran:</strong> ${transaksi.status}</p>
                <h5>Detail Produk</h5>
                <ul>
                    ${transaksi.keranjang.map(item => `<li>${item.nama} - ${item.jumlah} pcs - Rp ${item.subtotal.toFixed(2)}</li>`).join('')}
                </ul>
            `;
            document.getElementById('strukPembayaran').classList.remove('d-none');
        }

