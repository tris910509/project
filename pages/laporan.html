<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laporan Transaksi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h2 class="text-center">Laporan Transaksi</h2>

        <!-- Filter Laporan -->
        <div class="row mb-4">
            <div class="col-md-4">
                <label for="filterTanggal" class="form-label">Filter Tanggal</label>
                <input type="date" id="filterTanggal" class="form-control">
            </div>
            <div class="col-md-4">
                <label for="filterStatus" class="form-label">Filter Status</label>
                <select id="filterStatus" class="form-control">
                    <option value="">Semua Status</option>
                    <option value="Lunas">Lunas</option>
                    <option value="Belum Lunas">Belum Lunas</option>
                    <option value="Pending">Pending</option>
                </select>
            </div>
            <div class="col-md-4">
                <label for="filterPelanggan" class="form-label">Filter Pelanggan</label>
                <input type="text" id="filterPelanggan" class="form-control" placeholder="Nama Pelanggan">
            </div>
        </div>

        <!-- Tabel Laporan -->
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>#</th>
                    <th>ID Transaksi</th>
                    <th>Tanggal</th>
                    <th>Pelanggan</th>
                    <th>Metode Pembayaran</th>
                    <th>Status</th>
                    <th>Produk</th>
                    <th>Total</th>
                </tr>
            </thead>
            <tbody id="laporanTable">
                <!-- Data akan diisi melalui JavaScript -->
            </tbody>
        </table>
    </div>

    <script>
        const transaksiList = JSON.parse(localStorage.getItem('transaksi')) || [];

        // Fungsi untuk memformat angka menjadi format Rupiah
        function formatRupiah(angka) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
            }).format(angka);
        }

        // Render laporan transaksi
        function renderLaporan() {
            const filterTanggal = document.getElementById('filterTanggal').value;
            const filterStatus = document.getElementById('filterStatus').value;
            const filterPelanggan = document.getElementById('filterPelanggan').value.toLowerCase();

            const laporanTable = document.getElementById('laporanTable');
            laporanTable.innerHTML = '';

            // Filter data transaksi berdasarkan input
            const filteredTransaksi = transaksiList.filter(transaksi => {
                const matchTanggal =
                    !filterTanggal || transaksi.tanggal === filterTanggal;
                const matchStatus =
                    !filterStatus || transaksi.status === filterStatus;
                const matchPelanggan =
                    !filterPelanggan || transaksi.pelanggan.toLowerCase().includes(filterPelanggan);

                return matchTanggal && matchStatus && matchPelanggan;
            });

            // Render data transaksi ke dalam tabel
            filteredTransaksi.forEach((transaksi, index) => {
                const produkList = transaksi.produk
                    .map(produk => `${produk.nama} (${produk.jumlah}x)`)
                    .join(', ');

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${transaksi.id}</td>
                    <td>${transaksi.tanggal}</td>
                    <td>${transaksi.pelanggan}</td>
                    <td>${transaksi.metodePembayaran}</td>
                    <td>${transaksi.status}</td>
                    <td>${produkList}</td>
                    <td>${formatRupiah(transaksi.total)}</td>
                `;
                laporanTable.appendChild(row);
            });
        }

        // Event listener untuk filter
        document.getElementById('filterTanggal').addEventListener('input', renderLaporan);
        document.getElementById('filterStatus').addEventListener('change', renderLaporan);
        document.getElementById('filterPelanggan').addEventListener('input', renderLaporan);

        // Render laporan pertama kali
        renderLaporan();
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
