<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Halaman Transaksi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        #buktiPembayaranDiv {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h2 class="text-center">Halaman Transaksi</h2>

        <form id="transaksiForm">
            <!-- Kategori Pelanggan -->
            <div class="mb-3">
                <label for="kategoriPelanggan" class="form-label">Kategori Pelanggan</label>
                <select class="form-select" id="kategoriPelanggan" required>
                    <option value="Tersimpan">Pelanggan Tersimpan</option>
                    <option value="Umum">Pelanggan Umum</option>
                </select>
            </div>

            <!-- Pilih Pelanggan (Pelanggan yang Tersimpan) -->
            <div class="mb-3" id="pelangganTersimpanDiv">
                <label for="pelanggan" class="form-label">Pilih Pelanggan</label>
                <select class="form-select" id="pelanggan" required>
                    <option value="" disabled selected>Pilih Pelanggan</option>
                </select>
            </div>

            <!-- Form Pelanggan Umum -->
            <div class="mb-3" id="pelangganUmumDiv">
                <label for="namaPelanggan" class="form-label">Nama Pelanggan</label>
                <input type="text" class="form-control" id="namaPelanggan" placeholder="Masukkan Nama Pelanggan">

                <label for="noHpPelanggan" class="form-label mt-3">Nomor Handphone</label>
                <input type="text" class="form-control" id="noHpPelanggan" placeholder="Masukkan Nomor Handphone">

                <label for="alamatPelanggan" class="form-label mt-3">Alamat</label>
                <input type="text" class="form-control" id="alamatPelanggan" placeholder="Masukkan Alamat">
            </div>

            <!-- Pilih Produk -->
            <div class="mb-3">
                <label for="produk" class="form-label">Pilih Produk</label>
                <select class="form-select" id="produk">
                    <option value="" disabled selected>Pilih Produk</option>
                </select>
            </div>

            <!-- Jumlah Produk -->
            <div class="mb-3">
                <label for="jumlah" class="form-label">Jumlah</label>
                <input type="number" class="form-control" id="jumlah" placeholder="Masukkan jumlah produk">
            </div>

            <!-- Total -->
            <div class="mb-3">
                <label for="total" class="form-label">Total</label>
                <input type="number" class="form-control" id="total" readonly>
            </div>

            <!-- Metode Pembayaran -->
            <div class="mb-3">
                <label for="metodePembayaran" class="form-label">Metode Pembayaran</label>
                <select class="form-select" id="metodePembayaran" required>
                    <option value="Cash">Cash</option>
                    <option value="Transfer">Transfer</option>
                    <option value="QR">QR</option>
                    <option value="Ewallet">Ewallet</option>
                </select>
            </div>

            <!-- Jumlah Dibayar -->
            <div class="mb-3">
                <label for="bayar" class="form-label">Jumlah Dibayar</label>
                <input type="number" class="form-control" id="bayar" placeholder="Masukkan Jumlah Dibayar" required>
            </div>

            <!-- Bukti Pembayaran -->
            <div class="mb-3" id="buktiPembayaranDiv">
                <label for="buktiPembayaran" class="form-label">Upload Bukti Pembayaran</label>
                <input type="file" class="form-control" id="buktiPembayaran" accept=".jpg,.jpeg,.png,.pdf">
            </div>

            <button type="submit" class="btn btn-primary">Proses Transaksi</button>
        </form>
    </div>

    <script>
        const pelangganList = JSON.parse(localStorage.getItem('pelanggan')) || [];
        const transaksiList = JSON.parse(localStorage.getItem('transaksi')) || [];

        // Menangani kategori pelanggan
        document.getElementById('kategoriPelanggan').addEventListener('change', function () {
            const kategori = this.value;
            document.getElementById('pelangganTersimpanDiv').style.display = kategori === 'Tersimpan' ? 'block' : 'none';
            document.getElementById('pelangganUmumDiv').style.display = kategori === 'Umum' ? 'block' : 'none';
        });

        // Menangani metode pembayaran
        document.getElementById('metodePembayaran').addEventListener('change', function () {
            const metode = this.value;
            document.getElementById('buktiPembayaranDiv').style.display = metode === 'Cash' ? 'none' : 'block';
        });

        // Proses transaksi
        document.getElementById('transaksiForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const kategoriPelanggan = document.getElementById('kategoriPelanggan').value;
            let pelanggan;

            if (kategoriPelanggan === 'Umum') {
                pelanggan = {
                    id: 'PLG-' + Date.now(),
                    nama: document.getElementById('namaPelanggan').value,
                    noHp: document.getElementById('noHpPelanggan').value,
                    alamat: document.getElementById('alamatPelanggan').value
                };
                pelangganList.push(pelanggan);
                localStorage.setItem('pelanggan', JSON.stringify(pelangganList));
            } else {
                const pelangganId = document.getElementById('pelanggan').value;
                pelanggan = pelangganList.find(p => p.id === pelangganId);
            }

            const metodePembayaran = document.getElementById('metodePembayaran').value;
            const total = document.getElementById('total').value;
            const bayar = document.getElementById('bayar').value;
            const buktiPembayaran = metodePembayaran !== 'Cash' ? document.getElementById('buktiPembayaran').files[0]?.name : null;

            const transaksi = {
                id: 'TRX-' + Date.now(),
                pelanggan,
                metodePembayaran,
                total,
                bayar,
                status: metodePembayaran === 'Cash' && bayar >= total ? 'Lunas' : 'Belum Lunas',
                buktiPembayaran
            };

            transaksiList.push(transaksi);
            localStorage.setItem('transaksi', JSON.stringify(transaksiList));

            alert('Transaksi berhasil diproses!');
            location.reload();
        });

        // Render pelanggan tersimpan
        function renderPelanggan() {
            const pelangganSelect = document.getElementById('pelanggan');
            pelangganSelect.innerHTML = '<option value="" disabled selected>Pilih Pelanggan</option>';
            pelangganList.forEach(p => {
                const option = document.createElement('option');
                option.value = p.id;
                option.textContent = p.nama;
                pelangganSelect.appendChild(option);
            });
        }

        renderPelanggan();
    </script>
</body>
</html>
