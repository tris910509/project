<div class="container mt-5">
    <h2 class="text-center">Daftar Transaksi</h2>
    <table class="table">
        <thead>
            <tr>
                <th>ID Transaksi</th>
                <th>Pelanggan</th>
                <th>Total Pembayaran</th>
                <th>Status</th>
                <th>Aksi</th>
            </tr>
        </thead>
        <tbody id="daftarTransaksi">
            <!-- Daftar transaksi akan ditampilkan di sini -->
        </tbody>
    </table>
</div>

<!-- Modal Konfirmasi Pembayaran -->
<div class="modal" tabindex="-1" id="konfirmasiModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Konfirmasi Pembayaran</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>Masukkan ID Transaksi dan jumlah pembayaran yang sesuai:</p>
        <input type="text" id="idTransaksiKonfirmasi" class="form-control mb-3" placeholder="ID Transaksi" disabled>
        <input type="number" id="jumlahBayar" class="form-control" placeholder="Jumlah Pembayaran">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
        <button type="button" class="btn btn-primary" id="btnKonfirmasiPembayaran">Konfirmasi Pembayaran</button>
      </div>
    </div>
  </div>
</div>

<script>
    // Data transaksi (simulasi dari localStorage)
    let transaksiList = JSON.parse(localStorage.getItem('transaksi')) || [];

    // Menampilkan daftar transaksi
    function tampilkanDaftarTransaksi() {
        const table = document.getElementById('daftarTransaksi');
        table.innerHTML = ''; // Reset table
        transaksiList.forEach(transaksi => {
            if (transaksi.status === 'Belum Lunas') { // Hanya yang belum lunas
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${transaksi.id}</td>
                    <td>${transaksi.pelanggan}</td>
                    <td>${transaksi.total}</td>
                    <td>${transaksi.status}</td>
                    <td><button class="btn btn-success" onclick="konfirmasiPembayaran('${transaksi.id}')">Konfirmasi</button></td>
                `;
                table.appendChild(row);
            }
        });
    }

    // Memanggil modal konfirmasi pembayaran
    function konfirmasiPembayaran(idTransaksi) {
        const transaksi = transaksiList.find(t => t.id === idTransaksi);
        if (transaksi) {
            document.getElementById('idTransaksiKonfirmasi').value = transaksi.id;
            document.getElementById('jumlahBayar').value = ''; // Reset jumlah bayar
            $('#konfirmasiModal').modal('show');
        }
    }

    // Proses konfirmasi pembayaran
    document.getElementById('btnKonfirmasiPembayaran').addEventListener('click', function() {
        const idTransaksi = document.getElementById('idTransaksiKonfirmasi').value;
        const jumlahBayar = parseFloat(document.getElementById('jumlahBayar').value);
        
        const transaksi = transaksiList.find(t => t.id === idTransaksi);

        if (transaksi && jumlahBayar === transaksi.total) {
            transaksi.status = 'Lunas'; // Update status jadi lunas
            localStorage.setItem('transaksi', JSON.stringify(transaksiList)); // Simpan ke localStorage

            alert('Pembayaran berhasil dikonfirmasi! Status transaksi berubah menjadi Lunas.');
            $('#konfirmasiModal').modal('hide'); // Tutup modal
            tampilkanDaftarTransaksi(); // Refresh daftar transaksi
        } else {
            alert('Jumlah pembayaran tidak sesuai dengan total transaksi!');
        }
    });

    // Panggil fungsi untuk menampilkan transaksi pada halaman
    tampilkanDaftarTransaksi();
</script>
